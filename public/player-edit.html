<!-- File: public/player-edit.html
     Title: Edit Player Details - Drinking Mini Games
     Description: Allows users to edit player names, select each player's drink type,
                  and choose a unique player color. The Save Details button saves settings
                  and returns to the Game Home Screen.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Player Details - Drinking Mini Games</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
  <style>
    /* Additional CSS for color selection modal and color box */
    .color-box {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 2px solid #000;
      cursor: pointer;
      vertical-align: middle;
      margin-left: 10px;
      background-color: #ddd; /* Default: N/A */
    }
    .color-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 2px solid #000;
      padding: 20px;
      z-index: 1000;
    }
    .color-option {
      display: inline-block;
      width: 30px;
      height: 30px;
      margin: 5px;
      border: 2px solid #000;
      cursor: pointer;
    }
    .modal-overlay {
      display: none;
      position: fixed;
      top:0;
      left:0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 500;
    }
  </style>
</head>
<body>
  <header>
    <h1>Edit Player Details</h1>
  </header>
  <main>
    <form id="player-form">
      <div id="players-container">
        <!-- Player inputs will be inserted here -->
      </div>
      <button type="button" onclick="savePlayerDetails()">Save Details</button>
    </form>
  </main>
  <div id="modal-overlay" class="modal-overlay"></div>
  <div id="color-modal" class="color-modal">
    <p>Select a Color:</p>
    <div id="color-options">
      <!-- Color options will be generated here -->
    </div>
    <button onclick="closeColorModal()">Cancel</button>
  </div>
  <script>
    const availableColors = ["red", "green", "blue", "yellow", "purple", "orange", "cyan", "magenta", "lime", "pink"];
    const naColor = "n/a";
    let currentPlayerIndex = null;
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    function loadPlayerForm() {
      const playersContainer = document.getElementById("players-container");
      const numPlayers = parseInt(getQueryParam("players"), 10) || 1;
      playersContainer.innerHTML = "";
      for (let i = 1; i <= numPlayers; i++) {
        const playerDiv = document.createElement("div");
        playerDiv.className = "player-settings";
        playerDiv.style.margin = "10px 0";
        const nameLabel = document.createElement("label");
        nameLabel.textContent = "Player " + i + " Name: ";
        nameLabel.htmlFor = "player-name-" + i;
        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.id = "player-name-" + i;
        nameInput.value = "Player " + i;
        const drinkLabel = document.createElement("label");
        drinkLabel.textContent = " Drink: ";
        drinkLabel.htmlFor = "player-drink-" + i;
        const drinkSelect = document.createElement("select");
        drinkSelect.id = "player-drink-" + i;
        const optionBeer = document.createElement("option");
        optionBeer.value = "Beer";
        optionBeer.textContent = "Beer (min 2)";
        const optionLiqueur = document.createElement("option");
        optionLiqueur.value = "Liqueur";
        optionLiqueur.textContent = "Liqueur (min 1)";
        drinkSelect.appendChild(optionBeer);
        drinkSelect.appendChild(optionLiqueur);
        const colorBox = document.createElement("div");
        colorBox.className = "color-box";
        colorBox.setAttribute("data-color", naColor);
        colorBox.onclick = function() {
          openColorModal(i);
        };
        playerDiv.appendChild(nameLabel);
        playerDiv.appendChild(nameInput);
        playerDiv.appendChild(drinkLabel);
        playerDiv.appendChild(drinkSelect);
        playerDiv.appendChild(colorBox);
        playersContainer.appendChild(playerDiv);
      }
    }
    function openColorModal(playerIndex) {
      currentPlayerIndex = playerIndex;
      const modal = document.getElementById("color-modal");
      const overlay = document.getElementById("modal-overlay");
      const colorOptionsDiv = document.getElementById("color-options");
      colorOptionsDiv.innerHTML = "";
      availableColors.forEach(color => {
        let taken = false;
        const playerDivs = document.querySelectorAll(".player-settings");
        playerDivs.forEach((div, idx) => {
          if (idx + 1 !== playerIndex) {
            const cb = div.querySelector(".color-box");
            if (cb.getAttribute("data-color") === color) {
              taken = true;
            }
          }
        });
        const optionDiv = document.createElement("div");
        optionDiv.className = "color-option";
        optionDiv.style.backgroundColor = color;
        if (taken) {
          optionDiv.style.opacity = "0.5";
          optionDiv.style.pointerEvents = "none";
        }
        optionDiv.onclick = function() {
          selectColorForPlayer(color);
        };
        colorOptionsDiv.appendChild(optionDiv);
      });
      const naOption = document.createElement("div");
      naOption.className = "color-option";
      naOption.style.backgroundColor = "#ddd";
      naOption.textContent = "N/A";
      naOption.onclick = function() {
        selectColorForPlayer(naColor);
      };
      colorOptionsDiv.appendChild(naOption);
      modal.style.display = "block";
      overlay.style.display = "block";
    }
    function closeColorModal() {
      document.getElementById("color-modal").style.display = "none";
      document.getElementById("modal-overlay").style.display = "none";
    }
    function selectColorForPlayer(color) {
      const playerDivs = document.querySelectorAll(".player-settings");
      const targetDiv = playerDivs[currentPlayerIndex - 1];
      const colorBox = targetDiv.querySelector(".color-box");
      colorBox.style.backgroundColor = (color === naColor) ? "#ddd" : color;
      colorBox.setAttribute("data-color", color);
      closeColorModal();
    }
    function savePlayerDetails() {
      const players = [];
      const numPlayers = parseInt(getQueryParam("players"), 10) || 1;
      let allColorsValid = true;
      const playerDivs = document.querySelectorAll(".player-settings");
      playerDivs.forEach((div, idx) => {
        const name = div.querySelector("#player-name-" + (idx + 1)).value;
        const drink = div.querySelector("#player-drink-" + (idx + 1)).value;
        const color = div.querySelector(".color-box").getAttribute("data-color");
        if (color === naColor) {
          allColorsValid = false;
        }
        players.push({ name, drink, color });
      });
      if (!allColorsValid) {
        alert("Please select a valid color for all players (N/A is not allowed).");
        return;
      }
      localStorage.setItem("playerDetails", JSON.stringify(players));
      localStorage.setItem("playerCount", numPlayers);
      window.location.href = "../public/game-home.html";
    }
    window.onload = loadPlayerForm;
  </script>
</body>
</html>
